lines(t, Y117(t) * exp(sum(simreg1$coef[-1] * simdat1[17,c(2,3,5,7)])) * (exp(as.numeric(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$coef[1]))^(1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))) * (1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale)) * t^((1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))-1))
lines(t, Y134(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * (exp(as.numeric(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$coef[1]))^(1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))) * (1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale)) * t^((1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))-1))
Y134(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * (exp(as.numeric(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$coef[1]))^(1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))) * (1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale)) * t^((1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))-1)
Y117(t) * exp(sum(simreg1$coef[-1] * simdat1[17,c(2,3,5,7)])) * (exp(as.numeric(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$coef[1]))^(1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))) * (1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale)) * t^((1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))-1)
Y11 <- stepfun(simdat1$Survival[1],1:0, right = T)
Y117 <- stepfun(simdat1$Survival[17],1:0, right = T)
Y134 <- stepfun(simdat1$Survival[34],1:0, right = T)
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[1,c(2,3,5,7)])) * (exp(as.numeric(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$coef[1]))^(1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))) * (1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale)) * t^((1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))-1), type = "l", ylim = c(0, .0000000000001))
lines(t, Y117(t) * exp(sum(simreg1$coef[-1] * simdat1[17,c(2,3,5,7)])) * (exp(as.numeric(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$coef[1]))^(1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))) * (1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale)) * t^((1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))-1))
lines(t, Y134(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * (exp(as.numeric(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$coef[1]))^(1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))) * (1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale)) * t^((1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))-1))
Y11 <- stepfun(simdat1$Survival[1],1:0, right = T)
Y117 <- stepfun(simdat1$Survival[17],1:0, right = T)
Y134 <- stepfun(simdat1$Survival[34],1:0, right = T)
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[1,c(2,3,5,7)])) * (exp(as.numeric(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$coef[1]))^(1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))) * (1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale)) * t^((1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))-1), type = "l", ylim = c(0, .0000000000001), col = "green")
lines(t, Y117(t) * exp(sum(simreg1$coef[-1] * simdat1[17,c(2,3,5,7)])) * (exp(as.numeric(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$coef[1]))^(1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))) * (1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale)) * t^((1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))-1), col = "darkgreen")
lines(t, Y134(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * (exp(as.numeric(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$coef[1]))^(1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))) * (1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale)) * t^((1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))-1), col = "lightgreen")
Y11 <- stepfun(simdat1$Survival[1],1:0, right = T)
Y117 <- stepfun(simdat1$Survival[17],1:0, right = T)
Y134 <- stepfun(simdat1$Survival[34],1:0, right = T)
Y1 <- stepfun(tire$Survival[1],1:0, right = T)
Y17 <- stepfun(tire$Survival[17],1:0, right = T)
Y34 <- stepfun(tire$Survival[34],1:0, right = T)
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[1,c(2,3,5,7)])) * (exp(as.numeric(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$coef[1]))^(1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))) * (1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale)) * t^((1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))-1), type = "l", ylim = c(0, .0000000000001), col = "green")
lines(t, Y117(t) * exp(sum(simreg1$coef[-1] * simdat1[17,c(2,3,5,7)])) * (exp(as.numeric(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$coef[1]))^(1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))) * (1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale)) * t^((1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))-1), col = "darkgreen")
lines(t, Y134(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * (exp(as.numeric(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$coef[1]))^(1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))) * (1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale)) * t^((1/(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)$scale))-1), col = "lightgreen")
lines(t, Y34(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * (exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale))) * (1/(modwei$scale)) * t^(1/(modwei$scale) - 1), col = "green")
plot(t, Y34(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * (exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale))) * (1/(modwei$scale)) * t^(1/(modwei$scale) - 1), col = "green")
martingale_resid <- function(tireo,betas,t) {
tireoc <- tireo[tireo$Censor == 1,]$Survival
Y <- as.data.frame(matrix(nrow = length(tireoc), ncol = length(unique(tireoc))))
lambda <- c()
for (individ in 1:length(tireoc)) {
Amod <- c()
for (i in unique(tireoc)) {
Amoddenom <- c()
denom <- c()
tireotime <- tireo[tireo$Survival >= i,]
for (j in 1:nrow(tireotime)) {
if (i %in% tireoc[duplicated(tireoc)]) {
ties = c()
for (k in 1:2) {
ties <- c(ties, exp(sum(betas * c(as.numeric(tireotime[j,1:(ncol(tireotime) - 2)])))))
}
denom <- c(denom, sum(ties)/2)
} else {
denom <- c(denom, exp(sum(betas * c(as.numeric(tireotime[j,1:(ncol(tireotime) - 2)])))))
}
}
Amoddenom <- c(Amoddenom, sum(denom))
Amod <- c(Amod, 1/Amoddenom)
}
lambda <- c(lambda, sum((exp((sum(c(t(betas) * as.numeric(tireo[tireo$Censor == 1,][individ,1:(ncol(tireo) - 2)]))))) * Amod) * Y[individ,]))
}
return(lambda)
}
tireoc <- tireo[tireo$Censor == 1,]$Survival
plot(0,0,xlim = c(0,1.3),ylim=c(0,1))
for (i in 1:length(tireoc)) {
lines(unique(tireoc),stepfun(tireoc[i],1:0, right = T)(unique(tireoc)))
}
plot(1:11, 1 - martingale_resid(tireo,weib.coef.ph))
plot(1:11, 1 - martingale_resid(tireo,weib.coef.ph))
martingale_resid(tireo,weib.coef.ph)
martingale_resid <- function(tireo,betas) {
tireoc <- tireo[tireo$Censor == 1,]$Survival
Y <- as.data.frame(matrix(nrow = length(tireoc), ncol = length(unique(tireoc))))
lambda <- c()
for (individ in 1:length(tireoc)) {
Amod <- c()
for (i in unique(tireoc)) {
Amoddenom <- c()
denom <- c()
tireotime <- tireo[tireo$Survival >= i,]
for (j in 1:nrow(tireotime)) {
if (i %in% tireoc[duplicated(tireoc)]) {
ties = c()
for (k in 1:2) {
ties <- c(ties, exp(sum(betas * c(as.numeric(tireotime[j,1:(ncol(tireotime) - 2)])))))
}
denom <- c(denom, sum(ties)/2)
} else {
denom <- c(denom, exp(sum(betas * c(as.numeric(tireotime[j,1:(ncol(tireotime) - 2)])))))
}
}
Amoddenom <- c(Amoddenom, sum(denom))
Amod <- c(Amod, 1/Amoddenom)
}
lambda <- c(lambda, sum((exp((sum(c(t(betas) * as.numeric(tireo[tireo$Censor == 1,][individ,1:(ncol(tireo) - 2)]))))) * Amod) * Y[individ,]))
}
return(lambda)
}
tireoc <- tireo[tireo$Censor == 1,]$Survival
plot(0,0,xlim = c(0,1.3),ylim=c(0,1))
for (i in 1:length(tireoc)) {
lines(unique(tireoc),stepfun(tireoc[i],1:0, right = T)(unique(tireoc)))
}
plot(1:11, 1 - martingale_resid(tireo,weib.coef.ph))
plot(1:11, 1 - martingale_resid(tireo,weib.coef.ph))
1 - martingale_resid(tireo,weib.coef.ph)
plot(unique(tireo[tireo$Censor == 1,]$Survival),cumprod(1-hatA(tireo,betasmod)), type = "s", lwd = 3, xlim=c(0,1.3), ylim = c(.4,1), col = "blue", main = "Estimated survival functions", xlab = "Time", ylab = "Value")
lines(unique(tireo[tireo$Censor == 1,]$Survival),cumprod(1-hatA(tireo[,c(2,3,5,7,8,9)],betasmodsign)), type = "s", lwd = 3, col = "red")
t = seq(0,1.3,.01)
plot(t,exp(exp(sum(weib.coef.ph)) * pweibull(t,shape = 1/(modwei$scale), scale = exp(as.numeric(modwei$coef[1])),lower=F,log=T)),type="l", ylim = c(0,1), col = "blue", main = "Survival functions for the Weibull models")
lines(t,exp(exp(sum(weib.coef.ph.sign)) * pweibull(t,shape = 1/(modsignwei$scale), scale = exp(as.numeric(modsignwei$coef[1])),lower=F,log=T)), col = "red")
t = seq(0,1.3,.01)
plot(t,exp(exp(sum(weib.coef.ph)) * pweibull(t,shape = 1/(modwei$scale), scale = exp(as.numeric(modwei$coef[1])),lower=F,log=T)),type="l", ylim = c(0,1), col = "blue", main = "Survival functions for the Weibull models", xlab = "Time", ylab = "Value")
lines(t,exp(exp(sum(weib.coef.ph.sign)) * pweibull(t,shape = 1/(modsignwei$scale), scale = exp(as.numeric(modsignwei$coef[1])),lower=F,log=T)), col = "red")
t = seq(0,1.3,.01)
plot(t,exp(exp(sum(weib.coef.ph)) * pweibull(t,shape = 1/(modwei$scale), scale = exp(as.numeric(modwei$coef[1])),lower=F,log=T)),type="l", ylim = c(0,1), col = "blue", main = "Survival functions for the Weibull models", xlab = "Time", ylab = "Value")
lines(t,exp(exp(sum(weib.coef.ph.sign)) * pweibull(t,shape = 1/(modsignwei$scale), scale = exp(as.numeric(modsignwei$coef[1])),lower=F,log=T)), col = "red")
modweielim1 <- survreg(Surv(Survival, Censor) ~ Age + Wedge + Inter + EB2B + Peel + Carbon + WxP, tire)
summary(modweielim1)$table
modweielim2 <- update(modweielim1, . ~ Wedge + Inter + EB2B + Peel + Carbon + WxP)
summary(modweielim2)$table
modweielim3 <- update(modweielim1, . ~ Wedge + Inter + Peel + Carbon + WxP)
summary(modweielim3)$table
modweielim4 <- update(modweielim1, . ~ Wedge + Inter + Peel + WxP)
summary(modweielim4)$table
plot(unique(tireo[tireo$Censor == 1,]$Survival),cumprod(1-hatA(tireo,betasmod)), type = "s", lwd = 3, xlim=c(0,1.3), ylim = c(.4,1), col = "blue", main = "Estimated survival functions", xlab = "Time", ylab = "Value")
lines(unique(tireo[tireo$Censor == 1,]$Survival),cumprod(1-hatA(tireo[,c(2,3,5,7,8,9)],betasmodsign)), type = "s", lwd = 3, col = "red")
plot(unique(tireo[tireo$Censor == 1,]$Survival), hatA(tireo,betasmod), type = "s", lwd = 3, ylim = c(0,.5), col="blue", main = "Breslow estimators", xlab = "Time", ylab = "Value")
lines(unique(tireo[tireo$Censor == 1,]$Survival), hatA(tireo[,c(2,3,5,7,8,9)],betasmodsign), type = "s", lwd = 3, col="red")
t = seq(0,1.3,.01)
plot(t,exp(exp(sum(weib.coef.ph)) * pweibull(t,shape = 1/(modwei$scale), scale = exp(as.numeric(modwei$coef[1])),lower=F,log=T)),type="l", ylim = c(0,1), col = "blue", main = "Survival functions for the Weibull models", xlab = "Time", ylab = "Value")
lines(t,exp(exp(sum(weib.coef.ph.sign)) * pweibull(t,shape = 1/(modsignwei$scale), scale = exp(as.numeric(modsignwei$coef[1])),lower=F,log=T)), col = "red")
martingale_resid <- function(tireo,betas) {
tireoc <- tireo[tireo$Censor == 1,]$Survival
Y <- as.data.frame(matrix(nrow = length(tireoc), ncol = length(unique(tireoc))))
lambda <- c()
for (individ in 1:length(tireoc)) {
Amod <- c()
for (i in unique(tireoc)) {
Amoddenom <- c()
denom <- c()
tireotime <- tireo[tireo$Survival >= i,]
for (j in 1:nrow(tireotime)) {
if (i %in% tireoc[duplicated(tireoc)]) {
ties = c()
for (k in 1:2) {
ties <- c(ties, exp(sum(betas * c(as.numeric(tireotime[j,1:(ncol(tireotime) - 2)])))))
}
denom <- c(denom, sum(ties)/2)
} else {
denom <- c(denom, exp(sum(betas * c(as.numeric(tireotime[j,1:(ncol(tireotime) - 2)])))))
}
}
Amoddenom <- c(Amoddenom, sum(denom))
Amod <- c(Amod, 1/Amoddenom)
}
lambda <- c(lambda, sum((exp((sum(c(t(betas) * as.numeric(tireo[tireo$Censor == 1,][individ,1:(ncol(tireo) - 2)]))))) * Amod) * Y[individ,]))
}
return(lambda)
}
tireoc <- tireo[tireo$Censor == 1,]$Survival
plot(0,0,xlim = c(0,1.3),ylim=c(0,1))
for (i in 1:length(tireoc)) {
lines(unique(tireoc),stepfun(tireoc[i],1:0, right = T)(unique(tireoc)))
}
plot(1:11, 1 - martingale_resid(tireo,weib.coef.ph))
modweielim1 <- survreg(Surv(Survival, Censor) ~ Age + Wedge + Inter + EB2B + Peel + Carbon + WxP, tire)
summary(modweielim1)$table
modweielim2 <- update(modweielim1, . ~ Wedge + Inter + EB2B + Peel + Carbon + WxP)
summary(modweielim2)$table
modweielim3 <- update(modweielim1, . ~ Wedge + Inter + Peel + Carbon + WxP)
summary(modweielim3)$table
modweielim4 <- update(modweielim1, . ~ Wedge + Inter + Peel + WxP)
summary(modweielim4)$table
tireoc <- tireo[tireo$Censor == 1,]$Survival
plot(0,0,xlim = c(0,1.3),ylim=c(0,1))
for (i in 1:length(tireoc)) {
lines(unique(tireoc),stepfun(tireoc[i],1:0, right = T)(unique(tireoc)))
}
martingale_resid(tireo,weib.coef.ph)
lambda
sim2a <- function(tire, modweielim4, seed = 98) {
weib.coef.ph.sign <- -modsignwei$coef[2:5]/modsignwei$scale
set.seed(seed)
logu <- log(1 - runif(nrow(tire)))
a <- 1/(modweielim4$scale)
sigma <- exp(as.numeric(modweielim4$coef[1]))
K <- c()
for (i in 1:nrow(tire)) {
K <- c(K, exp(sum(t(weib.coef.ph.sign)*as.numeric(tire[i,c(2,3,5,7)]))))
}
t <- (-((sigma^a)/K) * logu)^(1/a)
censoredtimes <- rexp(nrow(tire),.95)
tildeTT <- c()
D <- c()
for (i in 1:nrow(tire)) {
tildeTT[i] <- min(t[i], censoredtimes[i])
ifelse(t[i] <= censoredtimes[i], D[i] <- 1, D[i] <- 0)
}
tiresim <- data.frame(Survival = t, Censor = D)
return(tiresim)
}
d <- c()
for (i in 1:500) {
d <- c(d,sim2a(tire,modweielim4,i)$Censor)
}
cat("Number of censored times in the original dataset:   ", length(tire$Censor[tire$Censor == 0]),
"\nNumber of censored times in 500 simulated datasets: ", length(d[d == 0])/500)
sim2a <- function(tire, modweielim4, seed = 98) {
weib.coef.ph.sign <- -modsignwei$coef[2:5]/modsignwei$scale
set.seed(seed)
logu <- log(1 - runif(nrow(tire)))
a <- 1/(modweielim4$scale)
sigma <- exp(as.numeric(modweielim4$coef[1]))
K <- c()
for (i in 1:nrow(tire)) {
K <- c(K, exp(sum(t(weib.coef.ph.sign)*as.numeric(tire[i,c(2,3,5,7)]))))
}
t <- (-((sigma^a)/K) * logu)^(1/a)
censoredtimes <- rexp(nrow(tire),.95)
tildeTT <- c()
D <- c()
for (i in 1:nrow(tire)) {
tildeTT[i] <- min(t[i], censoredtimes[i])
ifelse(t[i] <= censoredtimes[i], D[i] <- 1, D[i] <- 0)
}
tiresim <- data.frame(Survival = t, Censor = D)
return(tiresim)
}
d <- c()
for (i in 1:500) {
d <- c(d,sim2a(tire,modweielim4,i)$Censor)
}
cat("Number of censored times in the original dataset:   ", length(tire$Censor[tire$Censor == 0]),
"\nNumber of censored times in 500 simulated datasets: ", length(d[d == 0])/500)
fun2b <- function(full_model) {
model <- full_model
finished <- F
while (finished == F) {
model_summary <- data.frame(t(summary(model)$table[,4]))
model_summary <- model_summary[,-c(1,ncol(model_summary))]
if (max(model_summary) > .05) {
model_summary <- model_summary[-max.col(model_summary)]
model <- update(model, as.formula(paste(".~", paste(colnames(model_summary), collapse= "+"))))
} else {
final_model <- update(model, as.formula(paste(".~", paste(colnames(model_summary), collapse= "+"))))
finished <- T
}
}
return(summary(final_model)$table)
}
simdat1 <- tire
simdat1[,8:9] <- sim2a(tire,modweielim4)
simbestreg1 <- fun2b(survreg(Surv(Survival, Censor) ~ Age + Wedge + Inter + EB2B + Peel + Carbon + WxP, simdat1))
simreg1 <- summary(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1))
Y1(t)
exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * (exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale))) * (1/(modwei$scale)) * t^(1/(modwei$scale) - 1), col = "green")
sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])
simdat1
simreg1
simdat1[34,c(2,3,5,7)]
1/(modwei$scale)
(1/(modwei$scale))/(exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale)))
(1/(modwei$scale))/(exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale)))
exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale))
(1/(modwei$scale))-1
plot(t, Y1(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(modwei$scale))/(exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale)))) * t^((1/(modwei$scale))-1), col = "green")
plot(t, Y1(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(modwei$scale))/(exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
plot(t, Y1(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(modwei$scale))/(exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
lines(t, Y1(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(modwei$scale))/(exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale)))) * t^((1/(modwei$scale))-1), lty = 2, col = "green")
plot(t, Y1(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(modwei$scale))/(exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale)))) * t^((1/(modwei$scale))-1), lty = 2, col = "green")
lines(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(modwei$scale))/(exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale)))) * t^((1/(modwei$scale))-1), lty = 2, col = "green")
plot(t, Y1(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(modwei$scale))/(exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
lines(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(modwei$scale))/(exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale)))) * t^((1/(modwei$scale))-1), lty = 2, col = "green")
simdat1
modweielim4
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(modwei$scale))/(exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
lines(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)])) * ((1/(modwei$scale))/(exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale)))) * t^((1/(modwei$scale))-1), lty = 2, col = "green")
modwei
simdat1 <- tire
simdat1[,8:9] <- sim2a(tire,modweielim4)
simbestreg1 <- fun2b(survreg(Surv(Survival, Censor) ~ Age + Wedge + Inter + EB2B + Peel + Carbon + WxP, simdat1))
mod1 <- survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)
simreg1 <- summary(mod1)
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
lines(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)])) * ((1/(modwei$scale))/(exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale)))) * t^((1/(modwei$scale))-1), lty = 2, col = "green")
plot(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)])) * ((1/(modwei$scale))/(exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale)))) * t^((1/(modwei$scale))-1), lty = 2, type = "l", col = "green")
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
lines(t,exp(exp(sum(weib.coef.ph.sign)) * pweibull(t,shape = 1/(modsignwei$scale), scale = exp(as.numeric(modsignwei$coef[1])),lower=F,log=T)), col = "red")
plot(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)])) * ((1/(modwei$scale))/(exp(as.numeric(modwei$coef[1]))^(1/(modwei$scale)))) * t^((1/(modwei$scale))-1), lty = 2, type = "l", col = "green")
mod1
modwei
plot(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
plot(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
linesot(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
lines(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
a1 <- 1/(mod1$scale)
sigma1 <- exp(as.numeric(mod1$coef[1]))
Y11 <- stepfun(simdat1$Survival[1],1:0, right = T)
Y117 <- stepfun(simdat1$Survival[17],1:0, right = T)
Y134 <- stepfun(simdat1$Survival[34],1:0, right = T)
a1 <- 1/(mod1$scale)
sigma1 <- exp(as.numeric(mod1$coef[1]))
Y1 <- stepfun(tire$Survival[1],1:0, right = T)
Y17 <- stepfun(tire$Survival[17],1:0, right = T)
Y34 <- stepfun(tire$Survival[34],1:0, right = T)
a <- 1/(modsignwei$scale)
sigma <- exp(as.numeric(modwei$coef[1]))
a1
a
sigma1
sigma
mod1
sigma
modwei
(mod1$coef[1])
(modwei$coef[1])
exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)]))
exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)]))
simreg1$coef[-1]
modweielim4$coef[-1]
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[1,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
lines(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[1,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
Y11 <- stepfun(simdat1$Survival[1],1:0, right = T)
Y117 <- stepfun(simdat1$Survival[17],1:0, right = T)
Y134 <- stepfun(simdat1$Survival[34],1:0, right = T)
a1 <- 1/(mod1$scale)
sigma1 <- exp(as.numeric(mod1$coef[1]))
Y1 <- stepfun(tire$Survival[1],1:0, right = T)
Y17 <- stepfun(tire$Survival[17],1:0, right = T)
Y34 <- stepfun(tire$Survival[34],1:0, right = T)
a <- 1/(modsignwei$scale)
sigma <- exp(as.numeric(modwei$coef[1]))
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[1,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
lines(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[1,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
lines(t, Y117(t) * exp(sum(simreg1$coef[-1] * simdat1[17,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), lty = 2, type = "l", col = "green")
lines(t, Y17(t) * exp(sum(modweielim4$coef[-1] * tire[17,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
lines(t, Y134(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), lty = 2, type = "l", col = "green")
lines(t, Y34(t) * exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
t = seq(0,1.3,.01)
plot(t,exp(exp(sum(weib.coef.ph)) * pweibull(t,shape = 1/(modwei$scale), scale = exp(as.numeric(modwei$coef[1])),lower=F,log=T)),type="l", ylim = c(0,1), col = "blue")
lines(t,exp(exp(sum(weib.coef.ph.sign)) * pweibull(t,shape = 1/(modsignwei$scale), scale = exp(as.numeric(modsignwei$coef[1])),lower=F,log=T)), col = "red")
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[1,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[1,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
lines(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[1,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
lines(t, Y117(t) * exp(sum(simreg1$coef[-1] * simdat1[17,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), lty = 2, type = "l", col = "green")
lines(t, Y17(t) * exp(sum(modweielim4$coef[-1] * tire[17,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
lines(t, Y134(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), lty = 2, type = "l", col = "green")
lines(t, Y34(t) * exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[1,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
lines(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[1,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
lines(t, Y117(t) * exp(sum(simreg1$coef[-1] * simdat1[17,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), lty = 2, type = "l", col = "blue")
lines(t, Y17(t) * exp(sum(modweielim4$coef[-1] * tire[17,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "blue")
lines(t, Y134(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), lty = 2, type = "l", col = "red")
lines(t, Y34(t) * exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "red")
plot(t, Y117(t) * exp(sum(simreg1$coef[-1] * simdat1[17,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), lty = 2, type = "l", col = "blue")
Y11 <- stepfun(simdat1$Survival[1],1:0, right = T)
Y117 <- stepfun(simdat1$Survival[17],1:0, right = T)
Y134 <- stepfun(simdat1$Survival[34],1:0, right = T)
a1 <- 1/(mod1$scale)
sigma1 <- exp(as.numeric(mod1$coef[1]))
Y1 <- stepfun(tire$Survival[1],1:0, right = T)
Y17 <- stepfun(tire$Survival[17],1:0, right = T)
Y34 <- stepfun(tire$Survival[34],1:0, right = T)
a <- 1/(modsignwei$scale)
sigma <- exp(as.numeric(modwei$coef[1]))
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[1,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
lines(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[1,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
lines(t, Y117(t) * exp(sum(simreg1$coef[-1] * simdat1[17,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), lty = 2, type = "l", col = "blue")
lines(t, Y17(t) * exp(sum(modweielim4$coef[-1] * tire[17,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "blue")
lines(t, Y134(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), lty = 2, type = "l", col = "red")
lines(t, Y34(t) * exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "red")
t = seq(0,1.3,.01)
plot(t,exp(exp(sum(weib.coef.ph)) * pweibull(t,shape = 1/(modwei$scale), scale = exp(as.numeric(modwei$coef[1])),lower=F,log=T)),type="l", ylim = c(0,1), col = "blue")
lines(t,exp(exp(sum(weib.coef.ph.sign)) * pweibull(t,shape = 1/(modsignwei$scale), scale = exp(as.numeric(modsignwei$coef[1])),lower=F,log=T)), col = "red")
Y11 <- stepfun(simdat1$Survival[1],1:0, right = T)
Y117 <- stepfun(simdat1$Survival[17],1:0, right = T)
Y134 <- stepfun(simdat1$Survival[34],1:0, right = T)
a1 <- 1/(mod1$scale)
sigma1 <- exp(as.numeric(mod1$coef[1]))
Y1 <- stepfun(tire$Survival[1],1:0, right = T)
Y17 <- stepfun(tire$Survival[17],1:0, right = T)
Y34 <- stepfun(tire$Survival[34],1:0, right = T)
a <- 1/(modsignwei$scale)
sigma <- exp(as.numeric(modwei$coef[1]))
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[1,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
lines(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[1,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
lines(t, Y117(t) * exp(sum(simreg1$coef[-1] * simdat1[17,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), lty = 2, type = "l", col = "blue")
lines(t, Y17(t) * exp(sum(modweielim4$coef[-1] * tire[17,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "blue")
lines(t, Y134(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), lty = 2, type = "l", col = "red")
lines(t, Y34(t) * exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "red")
plot(t, Y117(t) * exp(sum(simreg1$coef[-1] * simdat1[17,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), lty = 2, type = "l", col = "blue")
lines(t, Y17(t) * exp(sum(modweielim4$coef[-1] * tire[17,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "blue")
Y11 <- stepfun(simdat1$Survival[1],1:0, right = T)
Y117 <- stepfun(simdat1$Survival[17],1:0, right = T)
Y134 <- stepfun(simdat1$Survival[34],1:0, right = T)
a1 <- 1/(mod1$scale)
sigma1 <- exp(as.numeric(mod1$coef[1]))
Y1 <- stepfun(tire$Survival[1],1:0, right = T)
Y17 <- stepfun(tire$Survival[17],1:0, right = T)
Y34 <- stepfun(tire$Survival[34],1:0, right = T)
a <- 1/(modsignwei$scale)
sigma <- exp(as.numeric(modwei$coef[1]))
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[1,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
lines(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[1,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
lines(t, Y117(t) * exp(sum(simreg1$coef[-1] * simdat1[17,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "blue")
lines(t, Y17(t) * exp(sum(modweielim4$coef[-1] * tire[17,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "blue")
lines(t, Y134(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1) type = "l", col = "red")
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[1,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green")
lines(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[1,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
lines(t, Y117(t) * exp(sum(simreg1$coef[-1] * simdat1[17,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "blue")
lines(t, Y17(t) * exp(sum(modweielim4$coef[-1] * tire[17,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "blue")
lines(t, Y134(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "red")
lines(t, Y34(t) * exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "red")
simdat2 <- tire
simdat2[,8:9] <- sim2a(tire,modweielim4,1)
simbestreg2 <- fun2b(survreg(Surv(Survival, Censor) ~ Age + Wedge + Inter + EB2B + Peel + Carbon + WxP, simdat2))
simreg2 <- summary(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg2[2:(nrow(simbestreg2)-1),]), collapse= "+"))), simdat1))
simdat3 <- tire
simdat3[,8:9] <- sim2a(tire,modweielim4,2)
simbestreg3 <- fun2b(survreg(Surv(Survival, Censor) ~ Age + Wedge + Inter + EB2B + Peel + Carbon + WxP, simdat3))
simreg3 <- summary(survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg3[2:(nrow(simbestreg3)-1),]), collapse= "+"))), simdat1))
Y11 <- stepfun(simdat1$Survival[1],1:0, right = T)
Y117 <- stepfun(simdat1$Survival[17],1:0, right = T)
Y134 <- stepfun(simdat1$Survival[34],1:0, right = T)
a1 <- 1/(mod1$scale)
sigma1 <- exp(as.numeric(mod1$coef[1]))
Y1 <- stepfun(tire$Survival[1],1:0, right = T)
Y17 <- stepfun(tire$Survival[17],1:0, right = T)
Y34 <- stepfun(tire$Survival[34],1:0, right = T)
a <- 1/(modsignwei$scale)
sigma <- exp(as.numeric(modwei$coef[1]))
plot(t, Y11(t) * exp(sum(simreg1$coef[-1] * simdat1[1,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "green", main = "Intensity processes", xlab = "Time", ylab = "Value")
lines(t, Y1(t) * exp(sum(modweielim4$coef[-1] * tire[1,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "green")
lines(t, Y117(t) * exp(sum(simreg1$coef[-1] * simdat1[17,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "blue")
lines(t, Y17(t) * exp(sum(modweielim4$coef[-1] * tire[17,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "blue")
lines(t, Y134(t) * exp(sum(simreg1$coef[-1] * simdat1[34,c(2,3,5,7)])) * ((1/(mod1$scale))/(exp(as.numeric(mod1$coef[1]))^(1/(mod1$scale)))) * t^((1/(modwei$scale))-1), type = "l", col = "red")
lines(t, Y34(t) * exp(sum(modweielim4$coef[-1] * tire[34,c(2,3,5,7)])) * ((1/(modsignwei$scale))/(exp(as.numeric(modsignwei$coef[1]))^(1/(modsignwei$scale)))) * t^((1/(modsignwei$scale))-1), lty = 2, type = "l", col = "red")
modweielim1 <- survreg(Surv(Survival, Censor) ~ Age + Wedge + Inter + EB2B + Peel + Carbon + WxP, tire)
summary(modweielim1)$table
modweielim2 <- update(modweielim1, . ~ Wedge + Inter + EB2B + Peel + Carbon + WxP)
summary(modweielim2)$table
modweielim3 <- update(modweielim1, . ~ Wedge + Inter + Peel + Carbon + WxP)
summary(modweielim3)$table
modweielim4 <- update(modweielim1, . ~ Wedge + Inter + Peel + WxP)
summary(modweielim4)$table
sim2a <- function(tire, modweielim4, seed = 98) {
weib.coef.ph.sign <- -modsignwei$coef[2:5]/modsignwei$scale
set.seed(seed)
logu <- log(1 - runif(nrow(tire)))
a <- 1/(modweielim4$scale)
sigma <- exp(as.numeric(modweielim4$coef[1]))
K <- c()
for (i in 1:nrow(tire)) {
K <- c(K, exp(sum(t(weib.coef.ph.sign)*as.numeric(tire[i,c(2,3,5,7)]))))
}
# Eq. 2.1:
t <- (-((sigma^a)/K) * logu)^(1/a)
censoredtimes <- rexp(nrow(tire),.95)
tildeTT <- c()
D <- c()
for (i in 1:nrow(tire)) {
tildeTT[i] <- min(t[i], censoredtimes[i])
ifelse(t[i] <= censoredtimes[i], D[i] <- 1, D[i] <- 0)
}
tiresim <- data.frame(Survival = t, Censor = D)
return(tiresim)
}
d <- c()
for (i in 1:500) {
d <- c(d,sim2a(tire,modweielim4,i)$Censor)
}
cat("Number of censored times in the original dataset:   ", length(tire$Censor[tire$Censor == 0]),
"\nNumber of censored times in 500 simulated datasets: ", length(d[d == 0])/500)
fun2b <- function(full_model) {
model <- full_model
finished <- F
while (finished == F) {
model_summary <- data.frame(t(summary(model)$table[,4]))
model_summary <- model_summary[,-c(1,ncol(model_summary))]
if (max(model_summary) > .05) {
model_summary <- model_summary[-max.col(model_summary)]
model <- update(model, as.formula(paste(".~", paste(colnames(model_summary), collapse= "+"))))
} else {
final_model <- update(model, as.formula(paste(".~", paste(colnames(model_summary), collapse= "+"))))
finished <- T
}
}
return(summary(final_model)$table)
}
simdat1 <- tire
simdat1[,8:9] <- sim2a(tire,modweielim4)
simbestreg1 <- fun2b(survreg(Surv(Survival, Censor) ~ Age + Wedge + Inter + EB2B + Peel + Carbon + WxP, simdat1))
mod1 <- survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)
simreg1 <- summary(mod1)
simdat1 <- tire
simdat1[,8:9] <- sim2a(tire,modweielim4)
simbestreg1 <- fun2b(survreg(Surv(Survival, Censor) ~ Age + Wedge + Inter + EB2B + Peel + Carbon + WxP, simdat1))
mod1 <- survreg(as.formula(paste("Surv(Survival, Censor) ~", paste(rownames(simbestreg1[2:(nrow(simbestreg1)-1),]), collapse= "+"))), simdat1)
simreg1 <- summary(mod1)
1/(modwei$scale)
ourshape <- 1/(modwei$scale)
ourshapesign <- 1/(modsignwei$scale)
ourshape
ourshapesign
ourshape
ourshape <- 1/(modwei$scale)
ourshapesign <- 1/(modsignwei$scale)
ourshape <- 1/(modwei$scale)
ourshapesign <- 1/(modsignwei$scale)
cat("a =", ourshape, "for the full model",
"\a =", ourshapesign, "for the significant model")
ourshape <- 1/(modwei$scale)
ourshapesign <- 1/(modsignwei$scale)
cat("a =", ourshape, "for the full model",
"\na =", ourshapesign, "for the significant model")
